--
-- PostgreSQL database dump
--

-- Dumped from database version 15.1
-- Dumped by pg_dump version 15.1

-- Started on 2023-11-27 13:19:24

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- TOC entry 264 (class 1259 OID 19291)
-- Name: anagrafica_utente; Type: TABLE; Schema: springboot_authentication; Owner: postgres
--

CREATE TABLE springboot_authentication.anagrafica_utente (
    id bigint NOT NULL,
    id_utente bigint NOT NULL,
    nome character varying,
    cognome character varying,
    data_nascita date,
    codice_fiscale character varying,
    indirizzo character varying,
    email character varying,
    telefono character varying
);


ALTER TABLE springboot_authentication.anagrafica_utente OWNER TO postgres;

--
-- TOC entry 263 (class 1259 OID 19290)
-- Name: anagrafica_utente_id_seq; Type: SEQUENCE; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE springboot_authentication.anagrafica_utente ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME springboot_authentication.anagrafica_utente_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 262 (class 1259 OID 19270)
-- Name: gerarchia; Type: TABLE; Schema: springboot_authentication; Owner: postgres
--

CREATE TABLE springboot_authentication.gerarchia (
    id bigint NOT NULL,
    parent_auth character varying NOT NULL,
    child_auth character varying NOT NULL,
    authority_type character varying NOT NULL
);


ALTER TABLE springboot_authentication.gerarchia OWNER TO postgres;

--
-- TOC entry 261 (class 1259 OID 19269)
-- Name: gerarchia_id_seq; Type: SEQUENCE; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE springboot_authentication.gerarchia ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME springboot_authentication.gerarchia_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 255 (class 1259 OID 19136)
-- Name: permesso; Type: TABLE; Schema: springboot_authentication; Owner: postgres
--

CREATE TABLE springboot_authentication.permesso (
    id character varying NOT NULL,
    descrizione character varying
);


ALTER TABLE springboot_authentication.permesso OWNER TO postgres;

--
-- TOC entry 256 (class 1259 OID 19143)
-- Name: ruolo; Type: TABLE; Schema: springboot_authentication; Owner: postgres
--

CREATE TABLE springboot_authentication.ruolo (
    id character varying NOT NULL,
    descrizione character varying
);


ALTER TABLE springboot_authentication.ruolo OWNER TO postgres;

--
-- TOC entry 257 (class 1259 OID 19150)
-- Name: ruolo_permesso; Type: TABLE; Schema: springboot_authentication; Owner: postgres
--

CREATE TABLE springboot_authentication.ruolo_permesso (
    id_ruolo character varying NOT NULL,
    id_permesso character varying NOT NULL
);


ALTER TABLE springboot_authentication.ruolo_permesso OWNER TO postgres;

--
-- TOC entry 254 (class 1259 OID 19127)
-- Name: utente; Type: TABLE; Schema: springboot_authentication; Owner: postgres
--

CREATE TABLE springboot_authentication.utente (
    id bigint NOT NULL,
    username character varying NOT NULL,
    password character varying NOT NULL,
    locked boolean NOT NULL,
    enabled boolean NOT NULL,
    created date NOT NULL,
    expire date
);


ALTER TABLE springboot_authentication.utente OWNER TO postgres;

--
-- TOC entry 253 (class 1259 OID 19126)
-- Name: user_id_seq; Type: SEQUENCE; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE springboot_authentication.utente ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME springboot_authentication.user_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 259 (class 1259 OID 19162)
-- Name: utente_permesso; Type: TABLE; Schema: springboot_authentication; Owner: postgres
--

CREATE TABLE springboot_authentication.utente_permesso (
    id_utente bigint NOT NULL,
    id_permesso character varying NOT NULL
);


ALTER TABLE springboot_authentication.utente_permesso OWNER TO postgres;

--
-- TOC entry 258 (class 1259 OID 19157)
-- Name: utente_ruolo; Type: TABLE; Schema: springboot_authentication; Owner: postgres
--

CREATE TABLE springboot_authentication.utente_ruolo (
    id_utente bigint NOT NULL,
    id_ruolo character varying NOT NULL
);


ALTER TABLE springboot_authentication.utente_ruolo OWNER TO postgres;

--
-- TOC entry 260 (class 1259 OID 19219)
-- Name: v_permessi_utente; Type: VIEW; Schema: springboot_authentication; Owner: postgres
--

CREATE VIEW springboot_authentication.v_permessi_utente AS
 SELECT row_number() OVER (ORDER BY w.id_utente) AS id,
    w.id_utente,
    w.username,
    w.locked,
    w.enabled,
    w.created,
    w.expire,
    w.id_permesso,
    w.descrizione
   FROM ( SELECT DISTINCT t.id_utente,
            t.username,
            t.locked,
            t.enabled,
            t.created,
            t.expire,
            t.id_permesso,
            t.descrizione
           FROM ( SELECT u.id AS id_utente,
                    u.username,
                    u.locked,
                    u.enabled,
                    u.created,
                    u.expire,
                    p.id AS id_permesso,
                    p.descrizione
                   FROM springboot_authentication.utente u,
                    springboot_authentication.ruolo r,
                    springboot_authentication.utente_ruolo ur,
                    springboot_authentication.ruolo_permesso rp,
                    springboot_authentication.permesso p
                  WHERE ((u.id = ur.id_utente) AND ((ur.id_ruolo)::text = (r.id)::text) AND ((rp.id_ruolo)::text = (r.id)::text) AND ((rp.id_permesso)::text = (p.id)::text))
                UNION ALL
                 SELECT u.id AS id_utente,
                    u.username,
                    u.locked,
                    u.enabled,
                    u.created,
                    u.expire,
                    p.id AS id_permesso,
                    p.descrizione
                   FROM springboot_authentication.utente u,
                    springboot_authentication.utente_permesso up,
                    springboot_authentication.permesso p
                  WHERE ((u.id = up.id_utente) AND ((up.id_permesso)::text = (p.id)::text))) t) w;


ALTER TABLE springboot_authentication.v_permessi_utente OWNER TO postgres;

--
-- TOC entry 3472 (class 0 OID 19291)
-- Dependencies: 264
-- Data for Name: anagrafica_utente; Type: TABLE DATA; Schema: springboot_authentication; Owner: postgres
--

INSERT INTO springboot_authentication.anagrafica_utente VALUES (13, 16, 'Super Utente', '', NULL, '', '', '', '');
INSERT INTO springboot_authentication.anagrafica_utente VALUES (14, 69, 'Utente TEST', '', NULL, '', '', '', '');
INSERT INTO springboot_authentication.anagrafica_utente VALUES (15, 12, 'Utente base', '', NULL, '', '', '', '');
INSERT INTO springboot_authentication.anagrafica_utente VALUES (16, 130, 'Cesare', 'Leonardi', '1978-05-11', 'LNRCSR78E11A006D', 'Via Fiume Bianco, 56, 00144, Roma, RM, Italia', 'cesare.leonardi@dgsspa.com', '+39 3337618482');


--
-- TOC entry 3470 (class 0 OID 19270)
-- Dependencies: 262
-- Data for Name: gerarchia; Type: TABLE DATA; Schema: springboot_authentication; Owner: postgres
--

INSERT INTO springboot_authentication.gerarchia VALUES (12, 'ADMINISTRATOR', 'SUPER_USER', 'ROLE');
INSERT INTO springboot_authentication.gerarchia VALUES (13, 'SUPER_USER', 'USER', 'ROLE');
INSERT INTO springboot_authentication.gerarchia VALUES (14, 'ADMIN', 'DELETE', 'AUTH');
INSERT INTO springboot_authentication.gerarchia VALUES (15, 'DELETE', 'WRITE', 'AUTH');
INSERT INTO springboot_authentication.gerarchia VALUES (16, 'WRITE', 'READ', 'AUTH');


--
-- TOC entry 3464 (class 0 OID 19136)
-- Dependencies: 255
-- Data for Name: permesso; Type: TABLE DATA; Schema: springboot_authentication; Owner: postgres
--

INSERT INTO springboot_authentication.permesso VALUES ('ADMIN', 'amministratore');
INSERT INTO springboot_authentication.permesso VALUES ('WRITE', 'scrittura');
INSERT INTO springboot_authentication.permesso VALUES ('DELETE', 'eliminazione');
INSERT INTO springboot_authentication.permesso VALUES ('READ', 'lettura');


--
-- TOC entry 3465 (class 0 OID 19143)
-- Dependencies: 256
-- Data for Name: ruolo; Type: TABLE DATA; Schema: springboot_authentication; Owner: postgres
--

INSERT INTO springboot_authentication.ruolo VALUES ('ADMINISTRATOR', 'amministratore');
INSERT INTO springboot_authentication.ruolo VALUES ('SUPER_USER', 'avanzato');
INSERT INTO springboot_authentication.ruolo VALUES ('USER', 'base');


--
-- TOC entry 3466 (class 0 OID 19150)
-- Dependencies: 257
-- Data for Name: ruolo_permesso; Type: TABLE DATA; Schema: springboot_authentication; Owner: postgres
--

INSERT INTO springboot_authentication.ruolo_permesso VALUES ('ADMINISTRATOR', 'ADMIN');
INSERT INTO springboot_authentication.ruolo_permesso VALUES ('USER', 'READ');
INSERT INTO springboot_authentication.ruolo_permesso VALUES ('SUPER_USER', 'WRITE');


--
-- TOC entry 3463 (class 0 OID 19127)
-- Dependencies: 254
-- Data for Name: utente; Type: TABLE DATA; Schema: springboot_authentication; Owner: postgres
--

INSERT INTO springboot_authentication.utente VALUES (16, 'super_user', '$2a$10$9u5awRV.EhoBueNjXwPiy.DO/Z3e/ltbov40M5DNNsXEXQTmj0JSC', false, true, '2023-06-05', NULL);
INSERT INTO springboot_authentication.utente VALUES (130, 'cesare.leonardi@dgsspa.com', '$2a$10$kJQj2LZhD3VtL9o2rE34LeckQ67Krze4TYkYzWpzSZnLfscKPtOv.', false, true, '2023-10-25', NULL);
INSERT INTO springboot_authentication.utente VALUES (12, 'user', '$2a$10$MWfJIJ4iPf5qBHlUbgBcNOvvsZeRV1TuNUaxOmoWjHeNRSu.xc41q', false, true, '2023-06-05', NULL);
INSERT INTO springboot_authentication.utente VALUES (69, 'test-0', '$2a$10$6MeA0K3o9YmJnXfKurgXG.b3x.TIWq2JAVw3Us1sKDvVv6v9UZnRG', false, true, '2023-05-23', '2025-01-01');
INSERT INTO springboot_authentication.utente VALUES (129, 'test-1', '$2a$10$Aw9anUOK3WHpJs.Pf3z0C.AvsGgL4CMBMPH3dNfLWeFc0K3o1iNly', false, true, '2023-11-22', '2019-11-22');
INSERT INTO springboot_authentication.utente VALUES (15, 'admin', '$2a$10$vNV8U1u5bmJJPs86htW/Vep2DEx2f/1f583.w.m4.PXLe0gc3ZuPy', false, true, '2023-06-05', NULL);


--
-- TOC entry 3468 (class 0 OID 19162)
-- Dependencies: 259
-- Data for Name: utente_permesso; Type: TABLE DATA; Schema: springboot_authentication; Owner: postgres
--



--
-- TOC entry 3467 (class 0 OID 19157)
-- Dependencies: 258
-- Data for Name: utente_ruolo; Type: TABLE DATA; Schema: springboot_authentication; Owner: postgres
--

INSERT INTO springboot_authentication.utente_ruolo VALUES (16, 'SUPER_USER');
INSERT INTO springboot_authentication.utente_ruolo VALUES (15, 'ADMINISTRATOR');
INSERT INTO springboot_authentication.utente_ruolo VALUES (130, 'ADMINISTRATOR');
INSERT INTO springboot_authentication.utente_ruolo VALUES (12, 'USER');
INSERT INTO springboot_authentication.utente_ruolo VALUES (129, 'USER');
INSERT INTO springboot_authentication.utente_ruolo VALUES (69, 'USER');


--
-- TOC entry 3478 (class 0 OID 0)
-- Dependencies: 263
-- Name: anagrafica_utente_id_seq; Type: SEQUENCE SET; Schema: springboot_authentication; Owner: postgres
--

SELECT pg_catalog.setval('springboot_authentication.anagrafica_utente_id_seq', 19, true);


--
-- TOC entry 3479 (class 0 OID 0)
-- Dependencies: 261
-- Name: gerarchia_id_seq; Type: SEQUENCE SET; Schema: springboot_authentication; Owner: postgres
--

SELECT pg_catalog.setval('springboot_authentication.gerarchia_id_seq', 16, true);


--
-- TOC entry 3480 (class 0 OID 0)
-- Dependencies: 253
-- Name: user_id_seq; Type: SEQUENCE SET; Schema: springboot_authentication; Owner: postgres
--

SELECT pg_catalog.setval('springboot_authentication.user_id_seq', 130, true);


--
-- TOC entry 3299 (class 2606 OID 19297)
-- Name: anagrafica_utente anagrafica_pk; Type: CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.anagrafica_utente
    ADD CONSTRAINT anagrafica_pk PRIMARY KEY (id);


--
-- TOC entry 3301 (class 2606 OID 19299)
-- Name: anagrafica_utente anagrafica_utente_un; Type: CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.anagrafica_utente
    ADD CONSTRAINT anagrafica_utente_un UNIQUE (id_utente);


--
-- TOC entry 3297 (class 2606 OID 19276)
-- Name: gerarchia gerarchia_pk; Type: CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.gerarchia
    ADD CONSTRAINT gerarchia_pk PRIMARY KEY (id);


--
-- TOC entry 3289 (class 2606 OID 19142)
-- Name: permesso permesso_pk; Type: CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.permesso
    ADD CONSTRAINT permesso_pk PRIMARY KEY (id);


--
-- TOC entry 3293 (class 2606 OID 19156)
-- Name: ruolo_permesso ruolo_permesso_pk; Type: CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.ruolo_permesso
    ADD CONSTRAINT ruolo_permesso_pk PRIMARY KEY (id_ruolo, id_permesso);


--
-- TOC entry 3291 (class 2606 OID 19149)
-- Name: ruolo ruolo_pk; Type: CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.ruolo
    ADD CONSTRAINT ruolo_pk PRIMARY KEY (id);


--
-- TOC entry 3285 (class 2606 OID 19133)
-- Name: utente user_pk; Type: CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.utente
    ADD CONSTRAINT user_pk PRIMARY KEY (id);


--
-- TOC entry 3287 (class 2606 OID 19135)
-- Name: utente user_un; Type: CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.utente
    ADD CONSTRAINT user_un UNIQUE (username);


--
-- TOC entry 3295 (class 2606 OID 19168)
-- Name: utente_permesso utente_permesso_pk; Type: CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.utente_permesso
    ADD CONSTRAINT utente_permesso_pk PRIMARY KEY (id_utente, id_permesso);


--
-- TOC entry 3308 (class 2606 OID 19300)
-- Name: anagrafica_utente anagrafica_utente_fk; Type: FK CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.anagrafica_utente
    ADD CONSTRAINT anagrafica_utente_fk FOREIGN KEY (id_utente) REFERENCES springboot_authentication.utente(id);


--
-- TOC entry 3302 (class 2606 OID 19169)
-- Name: ruolo_permesso ruolo_permesso_fk; Type: FK CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.ruolo_permesso
    ADD CONSTRAINT ruolo_permesso_fk FOREIGN KEY (id_ruolo) REFERENCES springboot_authentication.ruolo(id);


--
-- TOC entry 3303 (class 2606 OID 19174)
-- Name: ruolo_permesso ruolo_permesso_fk_1; Type: FK CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.ruolo_permesso
    ADD CONSTRAINT ruolo_permesso_fk_1 FOREIGN KEY (id_permesso) REFERENCES springboot_authentication.permesso(id);


--
-- TOC entry 3306 (class 2606 OID 19189)
-- Name: utente_permesso utente_permesso_fk; Type: FK CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.utente_permesso
    ADD CONSTRAINT utente_permesso_fk FOREIGN KEY (id_utente) REFERENCES springboot_authentication.utente(id);


--
-- TOC entry 3307 (class 2606 OID 19194)
-- Name: utente_permesso utente_permesso_fk_1; Type: FK CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.utente_permesso
    ADD CONSTRAINT utente_permesso_fk_1 FOREIGN KEY (id_permesso) REFERENCES springboot_authentication.permesso(id);


--
-- TOC entry 3304 (class 2606 OID 19179)
-- Name: utente_ruolo utente_ruolo_fk; Type: FK CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.utente_ruolo
    ADD CONSTRAINT utente_ruolo_fk FOREIGN KEY (id_ruolo) REFERENCES springboot_authentication.ruolo(id);


--
-- TOC entry 3305 (class 2606 OID 19184)
-- Name: utente_ruolo utente_ruolo_fk_1; Type: FK CONSTRAINT; Schema: springboot_authentication; Owner: postgres
--

ALTER TABLE ONLY springboot_authentication.utente_ruolo
    ADD CONSTRAINT utente_ruolo_fk_1 FOREIGN KEY (id_utente) REFERENCES springboot_authentication.utente(id);


-- Completed on 2023-11-27 13:19:24

--
-- PostgreSQL database dump complete
--

